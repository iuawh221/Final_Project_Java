<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chatbox AI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body { display: flex; margin: 0; font-family: "Segoe UI"; background: #eef1f7; }

        /* Sidebar */
        .sidebar {
          width: 260px;
          background: #2f3542;
          color: white;
          min-height: 100vh;
        }
        .sidebar .title {
          font-size: 22px;
          font-weight: 600;
          padding: 20px;
          border-bottom: 1px solid #3d4351;
          text-align: center;
        }
        .sidebar a {
          color: #cfd3da;
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 14px 20px;
          text-decoration: none;
          transition: 0.25s;
        }
        .sidebar a:hover { background: #57606f; color: white; }

        /* Content */
        .content-wrapper {
          flex-grow: 1;
          padding: 30px;
        }

        /* Chatbox */
        .chat-container {
          max-width: 800px;
          margin: auto;
          border: 1px solid #ddd;
          border-radius: 8px;
          display: flex;
          flex-direction: column;
          height: 600px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          background: white;
        }
        .chat-header {
          background: #4e73df;
          color: white;
          padding: 10px;
          font-weight: bold;
        }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; }

        /* Bubble style */
        .msg { margin: 8px 0; display: flex; }
        .msg.user { justify-content: flex-end; }
        .msg.bot { justify-content: flex-start; }
        .bubble {
          padding: 10px 14px;
          border-radius: 12px;
          max-width: 70%;
          line-height: 1.4;
        }
        .msg.user .bubble {
          background: #e9f0ff;
          color: #083062;
          border: 1px solid #cfe0ff;
        }
        .msg.bot .bubble {
          background: #f8f9fa;
          color: #2b2f38;
          border: 1px solid #ddd;
        }

        .chat-input { display: flex; border-top: 1px solid #ddd; }
        .chat-input input { flex: 1; border: none; padding: 10px; }
        .chat-input button { background: #4e73df; color: white; border: none; padding: 10px 20px; }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <div class="title">Admin Panel</div>
    <a th:href="@{/admin/index}"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a th:href="@{/admin/food}"><i class="bi bi-box-seam"></i> Quản lý món ăn</a>
    <a th:href="@{/admin/categories}"><i class="bi bi-tags"></i> Quản lý danh mục</a>
    <a th:href="@{/admin/users}"><i class="bi bi-people"></i> Quản lý người dùng</a>
    <a th:href="@{/admin/orders}"><i class="bi bi-receipt-cutoff"></i> Quản lý đơn hàng</a>
    <a th:href="@{/admin/chat}"><i class="bi bi-chat-dots"></i> Chatbox AI</a>
    <a th:href="@{/logout}"><i class="bi bi-box-arrow-right"></i> Đăng xuất</a>
</div>

<!-- Nội dung chính -->
<div class="content-wrapper">
    <div class="chat-container">
        <div class="chat-header">Trợ lý AI</div>
        <div id="messages" class="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Nhập câu hỏi...">
            <button onclick="sendMessage()">Gửi</button>
        </div>
    </div>
</div>

<script>
    const messages = document.getElementById("messages");

    async function sendMessage() {
  const input = document.getElementById("userInput");
  const msg = input.value.trim();
  if (!msg) return;
  addMessage(msg, "user");
  input.value = "";

  try {
    // nếu controller nằm trong /admin thì đổi đường dẫn
    const response = await fetch("/chat?question=" + encodeURIComponent(msg), {
     method: "POST"
    });

    if (!response.ok) {
      throw new Error("HTTP " + response.status);
    }
    const reply = await response.text();
    addMessage(reply, "bot");
  } catch (error) {
    addMessage("Lỗi khi gọi AI: " + error.message, "bot");
  }
}


    function addMessage(text, sender) {
      const row = document.createElement("div");
      row.className = "msg " + sender;

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;

      row.appendChild(bubble);
      messages.appendChild(row);
      messages.scrollTop = messages.scrollHeight;
    }
</script>

</body>
</html>
